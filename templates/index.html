<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìœ íŠœë¸Œ ë¹„ë””ì˜¤ ë‹¤ìš´ë¡œë”</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .main-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .search-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }
        .results-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }
        .video-card {
            border: 1px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }
        .video-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transform: translateY(-2px);
        }
        .video-thumbnail {
            width: 120px;
            height: 90px;
            object-fit: cover;
            border-radius: 8px;
        }
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 25px;
            padding: 12px 30px;
            font-weight: 600;
        }
        .btn-primary:hover {
            background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);
            transform: translateY(-1px);
        }
        .btn-success {
            background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
            border: none;
            border-radius: 25px;
            padding: 10px 25px;
        }
        .form-control {
            border-radius: 25px;
            border: 2px solid #e9ecef;
            padding: 12px 20px;
            font-size: 16px;
        }
        .form-control:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
        }
        .loading {
            display: none;
        }
        .alert {
            border-radius: 10px;
            border: none;
        }
        .progress {
            height: 8px;
            border-radius: 10px;
        }
        .pagination .page-link {
            border-radius: 8px;
            margin: 0 2px;
            border: 1px solid #dee2e6;
            color: #667eea;
        }
        .pagination .page-link:hover {
            background-color: #667eea;
            border-color: #667eea;
            color: white;
        }
        .pagination .page-item.active .page-link {
            background-color: #667eea;
            border-color: #667eea;
        }
        .pagination .page-item.disabled .page-link {
            color: #6c757d;
            background-color: #fff;
            border-color: #dee2e6;
        }
        .form-select {
            border-radius: 8px;
            border: 2px solid #e9ecef;
        }
        .form-select:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
        }
        .quick-folder-buttons {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        .quick-folder-buttons .btn {
            text-align: left;
            justify-content: flex-start;
        }
        .folder-input-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }
        .form-text {
            margin-top: 5px;
        }
        .btn-outline-success {
            border-color: #28a745;
            color: #28a745;
        }
        .btn-outline-success:hover {
            background-color: #28a745;
            border-color: #28a745;
            color: white;
        }
        .list-group-item {
            border: 1px solid #dee2e6;
            margin-bottom: 5px;
            border-radius: 8px;
            transition: all 0.2s;
        }
        .list-group-item:hover {
            background-color: #f8f9fa;
            border-color: #667eea;
        }
        .list-group-item strong {
            color: #495057;
        }
        .list-group-item small {
            color: #6c757d;
        }
        .modal-content {
            border-radius: 15px;
            border: none;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        .modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px 15px 0 0;
        }
        .modal-header .btn-close {
            filter: invert(1);
        }
        .channel-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            max-height: 300px;
            overflow-y: auto;
        }
        .channel-suggestion-item {
            padding: 10px 15px;
            border-bottom: 1px solid #f8f9fa;
            cursor: pointer;
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
        }
        .channel-suggestion-item:hover {
            background-color: #f8f9fa;
        }
        .channel-suggestion-item:last-child {
            border-bottom: none;
        }
        .channel-thumbnail {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 10px;
            object-fit: cover;
        }
        .channel-info {
            flex: 1;
        }
        .channel-title {
            font-weight: 600;
            color: #495057;
            margin-bottom: 2px;
        }
        .channel-description {
            font-size: 0.85rem;
            color: #6c757d;
        }
        .btn-group .btn {
            border-radius: 6px;
            margin: 0 2px;
        }
        .btn-outline-success {
            border-color: #28a745;
            color: #28a745;
        }
        .btn-outline-success:hover {
            background-color: #28a745;
            border-color: #28a745;
            color: white;
        }
        .btn-outline-secondary {
            border-color: #6c757d;
            color: #6c757d;
        }
        .btn-outline-secondary:hover {
            background-color: #6c757d;
            border-color: #6c757d;
            color: white;
        }
        .badge.bg-success {
            background-color: #28a745 !important;
        }
        .alert pre {
            white-space: pre-wrap;
            word-wrap: break-word;
            margin: 0;
            font-family: inherit;
        }
        .skipped-file {
            color: #6c757d;
            font-style: italic;
        }
        .failed-file {
            color: #dc3545;
            font-weight: 500;
        }
        .channel-suggestion-item.exact-match {
            background-color: #e8f5e8;
            border-left: 4px solid #28a745;
        }
        .channel-suggestion-item.exact-match:hover {
            background-color: #d4edda;
        }
        .exact-match .channel-title {
            font-weight: 700;
            color: #155724;
        }
        .form-check-input:checked {
            background-color: #28a745;
            border-color: #28a745;
        }
        .form-check-label {
            cursor: pointer;
            font-weight: 500;
        }
        .fab.fa-creative-commons {
            color: #28a745;
        }
        .card.bg-light {
            background-color: #f8f9fa !important;
            border-radius: 12px;
        }
        .form-label.fw-bold {
            color: #495057;
            font-size: 0.9rem;
        }
        .form-check-inline .form-check-input {
            margin-right: 0.5rem;
        }
        .form-check-label.fw-medium {
            font-weight: 500;
            color: #495057;
        }
        .search-section {
            border-radius: 20px;
        }
        .results-section {
            border-radius: 20px;
        }
    </style>
</head>
<body>
    <div class="main-container">
        <div class="text-center mb-4">
            <h1 class="display-4 text-primary">
                <i class="fab fa-youtube text-danger me-3"></i>
                ìœ íŠœë¸Œ ë¹„ë””ì˜¤ ë‹¤ìš´ë¡œë”
            </h1>
            <p class="lead text-muted">URLì„ ì…ë ¥í•˜ê±°ë‚˜ ê²€ìƒ‰ì–´ë¡œ ë¹„ë””ì˜¤ë¥¼ ì°¾ì•„ ë‹¤ìš´ë¡œë“œí•˜ì„¸ìš”</p>
            
            <!-- ì‚¬ìš©ì ê´€ë¦¬ ì„¹ì…˜ -->
            <div class="row justify-content-center mb-3">
                <div class="col-md-8">
                    <div class="card border-0 bg-light">
                        <div class="card-body py-3">
                            <div class="row align-items-center">
                                <div class="col-md-6">
                                    <div id="userInfo" style="display: none;">
                                        <div class="d-flex align-items-center">
                                            <i class="fas fa-user-circle text-primary me-2" style="font-size: 1.5rem;"></i>
                                            <div>
                                                <div class="fw-bold" id="userName">ì‚¬ìš©ìëª…</div>
                                                <small class="text-muted" id="userEmail">user@example.com</small>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="loginForm">
                                        <div class="input-group">
                                            <input type="email" id="userEmailInput" class="form-control" 
                                                   placeholder="ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”" style="border-radius: 25px 0 0 25px;">
                                            <button class="btn btn-outline-primary" type="button" onclick="loginUser()" 
                                                    style="border-radius: 0 25px 25px 0;">
                                                <i class="fas fa-sign-in-alt me-1"></i>ë¡œê·¸ì¸
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6 text-end">
                                    <div class="btn-group" role="group">
                                        <button class="btn btn-outline-info btn-sm" onclick="showUserHistory()" id="historyBtn" disabled>
                                            <i class="fas fa-history me-1"></i>íˆìŠ¤í† ë¦¬
                                        </button>
                                        <button class="btn btn-outline-warning btn-sm" onclick="showUserFavorites()" id="favoritesBtn" disabled>
                                            <i class="fas fa-star me-1"></i>ì¦ê²¨ì°¾ê¸°
                                        </button>
                                        <button class="btn btn-outline-secondary btn-sm" onclick="logoutUser()" id="logoutBtn" style="display: none;">
                                            <i class="fas fa-sign-out-alt me-1"></i>ë¡œê·¸ì•„ì›ƒ
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        

        <!-- ê²€ìƒ‰ ì„¹ì…˜ -->
        <div class="search-section">
            <div class="row mb-3">
                <div class="col-md-8">
                    <div class="input-group">
                        <input type="text" id="searchInput" class="form-control" 
                               placeholder="ìœ íŠœë¸Œ URL ë˜ëŠ” ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”...">
                        <button class="btn btn-primary" type="button" onclick="searchVideos()">
                            <i class="fas fa-search me-2"></i>ê²€ìƒ‰
                        </button>
                    </div>
                </div>
                <div class="col-md-4">
                    <button class="btn btn-success w-100" onclick="downloadSelected()">
                        <i class="fas fa-download me-2"></i>ì„ íƒ ë‹¤ìš´ë¡œë“œ
                    </button>
                </div>
            </div>
            
            <!-- ë‹¤ìš´ë¡œë“œ í´ë” ì„ íƒ -->
            <div class="row mt-3">
                <div class="col-12">
                    <label for="downloadFolderInput" class="form-label">
                        <i class="fas fa-folder me-2"></i>ë‹¤ìš´ë¡œë“œ í´ë” ê²½ë¡œ:
                    </label>
                    <div class="input-group">
                        <input type="text" id="downloadFolderInput" class="form-control" 
                               placeholder="í´ë” ê²½ë¡œë¥¼ ì§ì ‘ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: C:\Downloads\Videos)" 
                               value="">
                        <button class="btn btn-outline-secondary" type="button" onclick="showFolderSuggestions()">
                            <i class="fas fa-folder-open me-1"></i>í´ë” ì œì•ˆ
                        </button>
                        <button class="btn btn-outline-primary" type="button" onclick="testFolder()">
                            <i class="fas fa-check me-1"></i>í™•ì¸
                        </button>
                    </div>
                    <div class="form-text">
                        <small class="text-muted">
                            <i class="fas fa-info-circle me-1"></i>
                            í´ë”ê°€ ì¡´ì¬í•˜ì§€ ì•Šìœ¼ë©´ ìë™ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤.
                        </small>
                    </div>
                </div>
            </div>
            
            <!-- ì •ë ¬ ë° í•„í„° ì˜µì…˜ -->
            <div class="row mt-4">
                <div class="col-md-3">
                    <label for="sortSelect" class="form-label fw-bold">
                        <i class="fas fa-sort me-2"></i>ì •ë ¬ ê¸°ì¤€
                    </label>
                    <select id="sortSelect" class="form-select">
                        <option value="relevance">ê´€ë ¨ì„±</option>
                        <option value="date">ì—…ë¡œë“œ ë‚ ì§œ</option>
                        <option value="rating">í‰ì </option>
                        <option value="viewCount">ì¡°íšŒìˆ˜</option>
                        <option value="title">ì œëª©</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <label for="resultsPerPage" class="form-label fw-bold">
                        <i class="fas fa-list me-2"></i>í˜ì´ì§€ë‹¹ ê²°ê³¼ ìˆ˜
                    </label>
                    <select id="resultsPerPage" class="form-select">
                        <option value="10">10ê°œ</option>
                        <option value="25">25ê°œ</option>
                        <option value="50" selected>50ê°œ</option>
                        <option value="100">100ê°œ</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <label for="channelFilter" class="form-label fw-bold">
                        <i class="fas fa-user me-2"></i>ì±„ë„ í•„í„°
                    </label>
                    <div class="input-group">
                        <input type="text" id="channelFilter" class="form-control" 
                               placeholder="ì±„ë„ëª…ì„ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: TED)"
                               oninput="searchChannels(this.value)"
                               autocomplete="off">
                        <button class="btn btn-outline-secondary" type="button" onclick="clearChannelFilter()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="form-text">
                        <small class="text-muted">
                            <i class="fas fa-info-circle me-1"></i>
                            íŠ¹ì • ì±„ë„ì˜ ë¹„ë””ì˜¤ë§Œ ê²€ìƒ‰í•©ë‹ˆë‹¤
                        </small>
                    </div>
                    <!-- ì±„ë„ ìë™ì™„ì„± ë“œë¡­ë‹¤ìš´ -->
                    <div id="channelSuggestions" class="channel-suggestions" style="display: none;">
                        <!-- ì±„ë„ ì œì•ˆë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                    </div>
                </div>
                <div class="col-md-2 d-flex align-items-end">
                    <button class="btn btn-outline-primary w-100" onclick="searchVideos()">
                        <i class="fas fa-sync-alt me-1"></i>ìƒˆë¡œê³ ì¹¨
                    </button>
                </div>
            </div>
            
            <!-- ë¹„ë””ì˜¤ ê¸¸ì´ í•„í„° -->
            <div class="row mt-3" style="background-color: #ff0000; padding: 20px; border: 5px solid #00ff00;">
                <div class="col-12">
                    <h2 style="color: white; font-size: 24px;">ğŸš¨ ì‹œê°„ í•„í„° í…ŒìŠ¤íŠ¸ ğŸš¨</h2>
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-md-3">
                    <label class="form-label fw-bold">
                        <i class="fas fa-clock me-2"></i>ë¹„ë””ì˜¤ ê¸¸ì´
                    </label>
                    <select id="durationFilter" class="form-select" onchange="updateDurationFilter()">
                        <option value="">ì „ì²´</option>
                        <option value="short">4ë¶„ ë¯¸ë§Œ</option>
                        <option value="medium">4-20ë¶„</option>
                        <option value="long">20ë¶„ ì´ìƒ</option>
                    </select>
                </div>
                <div class="col-md-9 d-flex align-items-end">
                    <small class="text-muted">
                        <i class="fas fa-info-circle me-1"></i>
                        ë¹„ë””ì˜¤ ê¸¸ì´ì— ë”°ë¼ ê²€ìƒ‰ ê²°ê³¼ë¥¼ í•„í„°ë§í•©ë‹ˆë‹¤
                    </small>
                </div>
            </div>
            
            <!-- ë¼ì´ì„ ìŠ¤ í•„í„° -->
            <div class="row mt-3">
                <div class="col-12">
                    <div class="card border-0 bg-light">
                        <div class="card-body py-3">
                            <div class="row align-items-center">
                                <div class="col-md-2">
                                    <label class="form-label fw-bold mb-0">
                                        <i class="fas fa-filter me-2"></i>ë¼ì´ì„ ìŠ¤ í•„í„°
                                    </label>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="checkbox" id="creativeCommonsFilter" 
                                               onchange="updateCreativeCommonsFilter()">
                                        <label class="form-check-label fw-medium" for="creativeCommonsFilter">
                                            <i class="fab fa-creative-commons me-2 text-success"></i>
                                            í¬ë¦¬ì—ì´í‹°ë¸Œ ì»¤ë¨¼ì¦ˆ
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <small class="text-muted">
                                        <i class="fas fa-info-circle me-1"></i>
                                        í¬ë¦¬ì—ì´í‹°ë¸Œ ì»¤ë¨¼ì¦ˆ ë¼ì´ì„ ìŠ¤ ë¹„ë””ì˜¤ë§Œ ê²€ìƒ‰í•©ë‹ˆë‹¤
                                    </small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ë¡œë”© í‘œì‹œ -->
        <div class="loading text-center" id="loadingSection">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">ë¡œë”© ì¤‘...</span>
            </div>
            <p class="mt-2">ê²€ìƒ‰ ì¤‘ì…ë‹ˆë‹¤...</p>
        </div>

        <!-- ê²°ê³¼ ì„¹ì…˜ -->
        <div class="results-section" id="resultsSection" style="display: none;">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h3 class="mb-0">
                    <i class="fas fa-list me-2"></i>ê²€ìƒ‰ ê²°ê³¼
                    <span class="badge bg-primary ms-2" id="resultCount">0</span>
                </h3>
                <div class="d-flex align-items-center">
                    <div class="text-muted me-3">
                        ì´ <span id="totalResults">0</span>ê°œ ì¤‘ <span id="currentPageInfo">0-0</span>ê°œ í‘œì‹œ
                    </div>
                    <div class="btn-group" role="group">
                        <button class="btn btn-outline-success btn-sm" onclick="selectAllVideos()">
                            <i class="fas fa-check-square me-1"></i>ì „ì²´ ì„ íƒ
                        </button>
                        <button class="btn btn-outline-secondary btn-sm" onclick="deselectAllVideos()">
                            <i class="fas fa-square me-1"></i>ì „ì²´ í•´ì œ
                        </button>
                    </div>
                </div>
            </div>
            <div id="videoResults"></div>
            
            <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
            <nav aria-label="ê²€ìƒ‰ ê²°ê³¼ í˜ì´ì§€ë„¤ì´ì…˜" id="paginationNav" style="display: none;">
                <ul class="pagination justify-content-center">
                    <li class="page-item" id="prevPageItem">
                        <button class="page-link" onclick="goToPreviousPage()" id="prevPageBtn">
                            <i class="fas fa-chevron-left"></i> ì´ì „
                        </button>
                    </li>
                    <li class="page-item active" id="currentPageItem">
                        <span class="page-link" id="currentPageNumber">1</span>
                    </li>
                    <li class="page-item" id="nextPageItem">
                        <button class="page-link" onclick="goToNextPage()" id="nextPageBtn">
                            ë‹¤ìŒ <i class="fas fa-chevron-right"></i>
                        </button>
                    </li>
                </ul>
            </nav>
        </div>

        <!-- ì•Œë¦¼ ë©”ì‹œì§€ -->
        <div id="alertContainer"></div>

        <!-- í´ë” ì œì•ˆ ëª¨ë‹¬ -->
        <div class="modal fade" id="folderSuggestionsModal" tabindex="-1" aria-labelledby="folderSuggestionsModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="folderSuggestionsModalLabel">
                            <i class="fas fa-folder-open me-2"></i>í´ë” ì„ íƒ
                        </h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h6><i class="fas fa-desktop me-2"></i>ì‹œìŠ¤í…œ í´ë”</h6>
                                <div class="list-group" id="systemFolders">
                                    <!-- ì‹œìŠ¤í…œ í´ë”ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                                </div>
                            </div>
                            <div class="col-md-6">
                                <h6><i class="fas fa-folder me-2"></i>í”„ë¡œì íŠ¸ í´ë”</h6>
                                <div class="list-group" id="projectFolders">
                                    <!-- í”„ë¡œì íŠ¸ í´ë”ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                                </div>
                            </div>
                        </div>
                        <hr>
                        <div class="mt-3">
                            <h6><i class="fas fa-edit me-2"></i>ì§ì ‘ ì…ë ¥</h6>
                            <div class="input-group">
                                <input type="text" id="customFolderPath" class="form-control" 
                                       placeholder="í´ë” ê²½ë¡œë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                                <button class="btn btn-primary" type="button" onclick="selectCustomFolder()">
                                    <i class="fas fa-check me-1"></i>ì„ íƒ
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ì·¨ì†Œ</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ì‚¬ìš©ì íˆìŠ¤í† ë¦¬ ëª¨ë‹¬ -->
        <div class="modal fade" id="userHistoryModal" tabindex="-1" aria-labelledby="userHistoryModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-xl">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="userHistoryModalLabel">
                            <i class="fas fa-history me-2"></i>ë‹¤ìš´ë¡œë“œ íˆìŠ¤í† ë¦¬
                        </h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div id="historyContent">
                            <div class="text-center">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">ë¡œë”© ì¤‘...</span>
                                </div>
                                <p class="mt-2">íˆìŠ¤í† ë¦¬ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ë‹«ê¸°</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ì‚¬ìš©ì ì¦ê²¨ì°¾ê¸° ëª¨ë‹¬ -->
        <div class="modal fade" id="userFavoritesModal" tabindex="-1" aria-labelledby="userFavoritesModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-xl">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="userFavoritesModalLabel">
                            <i class="fas fa-star me-2"></i>ì¦ê²¨ì°¾ê¸°
                        </h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div id="favoritesContent">
                            <div class="text-center">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">ë¡œë”© ì¤‘...</span>
                                </div>
                                <p class="mt-2">ì¦ê²¨ì°¾ê¸°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ë‹«ê¸°</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let selectedVideos = new Set();
        let currentPageToken = null;
        let nextPageToken = null;
        let prevPageToken = null;
        let currentPage = 1;
        let totalResults = 0;
        let currentQuery = '';
        let downloadFolders = [];
        let selectedDownloadFolder = '';
        
        // ì‚¬ìš©ì ê´€ë¦¬ ë³€ìˆ˜
        let currentUser = null;
        let userHistory = [];
        let userFavorites = [];

        function showAlert(message, type = 'info') {
            const alertContainer = document.getElementById('alertContainer');
            const alertHtml = `
                <div class="alert alert-${type} alert-dismissible fade show" role="alert">
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            `;
            alertContainer.innerHTML = alertHtml;
            
            // 5ì´ˆ í›„ ìë™ìœ¼ë¡œ ì‚¬ë¼ì§€ê²Œ ì„¤ì •
            setTimeout(() => {
                const alert = alertContainer.querySelector('.alert');
                if (alert) {
                    alert.remove();
                }
            }, 5000);
        }

        function showLoading(show) {
            const loadingSection = document.getElementById('loadingSection');
            const resultsSection = document.getElementById('resultsSection');
            
            if (show) {
                loadingSection.style.display = 'block';
                resultsSection.style.display = 'none';
            } else {
                loadingSection.style.display = 'none';
                resultsSection.style.display = 'block';
            }
        }

        function searchVideos(pageToken = null) {
            const query = document.getElementById('searchInput').value.trim();
            const sortBy = document.getElementById('sortSelect').value;
            const maxResults = parseInt(document.getElementById('resultsPerPage').value);
            const channelFilter = document.getElementById('channelFilter').value.trim();
            const creativeCommons = document.getElementById('creativeCommonsFilter').checked;
            const durationFilter = document.getElementById('durationFilter').value;
            
            if (!query) {
                showAlert('ê²€ìƒ‰ì–´ ë˜ëŠ” URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'warning');
                return;
            }

            showLoading(true);
            selectedVideos.clear();
            
            // ìƒˆë¡œìš´ ê²€ìƒ‰ì¸ ê²½ìš° í˜ì´ì§€ ì •ë³´ ì´ˆê¸°í™”
            if (!pageToken) {
                currentPage = 1;
                currentPageToken = null;
                currentQuery = query;
            }

            const requestData = {
                query: query,
                sort_by: sortBy,
                max_results: maxResults,
                creative_commons: creativeCommons,
                duration_filter: durationFilter || null
            };
            
            // ì±„ë„ í•„í„°ê°€ ìˆìœ¼ë©´ ë³„ë„ íŒŒë¼ë¯¸í„°ë¡œ ì „ì†¡
            if (channelFilter) {
                requestData.channel_filter = channelFilter;
            }
            
            if (pageToken) {
                requestData.page_token = pageToken;
            }

            fetch('/search', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(requestData)
            })
            .then(response => response.json())
            .then(data => {
                showLoading(false);
                
                if (data.error) {
                    showAlert(data.error, 'danger');
                    return;
                }

                // í˜ì´ì§€ë„¤ì´ì…˜ ì •ë³´ ì—…ë°ì´íŠ¸
                nextPageToken = data.next_page_token;
                prevPageToken = data.prev_page_token;
                totalResults = data.total_results || data.results.length;

                // ì±„ë„ í•„í„° ë””ë²„ê¹… ì •ë³´
                if (channelFilter) {
                    console.log(`ì±„ë„ í•„í„° ì ìš©: "${channelFilter}"`);
                    console.log(`ê²€ìƒ‰ ê²°ê³¼: ${data.results.length}ê°œ`);
                }

                displayResults(data.results);
                updatePagination();
            })
            .catch(error => {
                showLoading(false);
                showAlert('ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message, 'danger');
            });
        }

        function displayResults(results) {
            const videoResults = document.getElementById('videoResults');
            const resultCount = document.getElementById('resultCount');
            const totalResultsSpan = document.getElementById('totalResults');
            const currentPageInfo = document.getElementById('currentPageInfo');
            
            // ì„ íƒ ìƒíƒœ ì´ˆê¸°í™”
            selectedVideos.clear();
            
            resultCount.textContent = results.length;
            totalResultsSpan.textContent = totalResults.toLocaleString();
            
            // í˜„ì¬ í˜ì´ì§€ ì •ë³´ ì—…ë°ì´íŠ¸
            const startIndex = (currentPage - 1) * parseInt(document.getElementById('resultsPerPage').value) + 1;
            const endIndex = startIndex + results.length - 1;
            currentPageInfo.textContent = `${startIndex}-${endIndex}`;
            
            if (results.length === 0) {
                videoResults.innerHTML = '<p class="text-muted text-center">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                updateSelectionStatus();
                return;
            }

            let html = '';
            results.forEach((video, index) => {
                const duration = formatDuration(video.duration);
                const isSelected = selectedVideos.has(video.url);
                
                html += `
                    <div class="video-card">
                        <div class="row align-items-center">
                            <div class="col-md-1">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" 
                                           id="video${index}" value="${video.url}"
                                           ${isSelected ? 'checked' : ''}
                                           onchange="toggleVideoSelection('${video.url}')">
                                </div>
                            </div>
                            <div class="col-md-2">
                                <img src="${video.thumbnail || 'https://via.placeholder.com/120x90'}" 
                                     alt="ì¸ë„¤ì¼" class="video-thumbnail">
                            </div>
                            <div class="col-md-7">
                                <h5 class="mb-2">${video.title}</h5>
                                <div class="row mb-2">
                                    <div class="col-md-6">
                                        <p class="text-muted mb-1">
                                            <i class="fas fa-user me-2"></i>${video.channel_title || 'Unknown Channel'}
                                        </p>
                                        <p class="text-muted mb-1">
                                            <i class="fas fa-clock me-2"></i>${duration}
                                        </p>
                                    </div>
                                    <div class="col-md-6">
                                        <p class="text-muted mb-1">
                                            <i class="fas fa-eye me-2"></i>${formatNumber(video.view_count || '0')} ì¡°íšŒ
                                        </p>
                                        <p class="text-muted mb-1">
                                            <i class="fas fa-calendar me-2"></i>${video.upload_date || 'Unknown Date'}
                                        </p>
                                    </div>
                                </div>
                                <p class="text-muted mb-0">
                                    <i class="fas fa-link me-2"></i>
                                    <a href="${video.url}" target="_blank" class="text-decoration-none">
                                        ${video.url}
                                    </a>
                                </p>
                            </div>
                            <div class="col-md-2 text-end">
                                <button class="btn btn-outline-primary btn-sm" 
                                        onclick="downloadSingle('${video.url}')">
                                    <i class="fas fa-download me-1"></i>ë‹¤ìš´ë¡œë“œ
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            videoResults.innerHTML = html;
            updateSelectionStatus();
        }

        function formatDuration(seconds) {
            if (typeof seconds === 'string') return seconds;
            if (!seconds) return '00:00';
            
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            const secs = seconds % 60;
            
            if (hours > 0) {
                return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            } else {
                return `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            }
        }

        function formatNumber(num) {
            if (!num) return '0';
            const number = parseInt(num);
            if (number >= 1000000) {
                return (number / 1000000).toFixed(1) + 'M';
            } else if (number >= 1000) {
                return (number / 1000).toFixed(1) + 'K';
            }
            return number.toLocaleString();
        }

        function updatePagination() {
            const paginationNav = document.getElementById('paginationNav');
            const prevPageItem = document.getElementById('prevPageItem');
            const nextPageItem = document.getElementById('nextPageItem');
            const currentPageNumber = document.getElementById('currentPageNumber');
            const prevPageBtn = document.getElementById('prevPageBtn');
            const nextPageBtn = document.getElementById('nextPageBtn');

            // í˜ì´ì§€ë„¤ì´ì…˜ì´ í•„ìš”í•œì§€ í™•ì¸
            if (!nextPageToken && !prevPageToken) {
                paginationNav.style.display = 'none';
                return;
            }

            paginationNav.style.display = 'block';
            currentPageNumber.textContent = currentPage;

            // ì´ì „ í˜ì´ì§€ ë²„íŠ¼ ìƒíƒœ
            if (prevPageToken) {
                prevPageItem.classList.remove('disabled');
                prevPageBtn.disabled = false;
            } else {
                prevPageItem.classList.add('disabled');
                prevPageBtn.disabled = true;
            }

            // ë‹¤ìŒ í˜ì´ì§€ ë²„íŠ¼ ìƒíƒœ
            if (nextPageToken) {
                nextPageItem.classList.remove('disabled');
                nextPageBtn.disabled = false;
            } else {
                nextPageItem.classList.add('disabled');
                nextPageBtn.disabled = true;
            }
        }

        function goToNextPage() {
            if (nextPageToken) {
                currentPage++;
                currentPageToken = nextPageToken;
                searchVideos(nextPageToken);
            }
        }

        function goToPreviousPage() {
            if (prevPageToken) {
                currentPage--;
                currentPageToken = prevPageToken;
                searchVideos(prevPageToken);
            }
        }

        function toggleVideoSelection(url) {
            if (selectedVideos.has(url)) {
                selectedVideos.delete(url);
            } else {
                selectedVideos.add(url);
            }
            updateSelectionStatus();
        }

        function selectAllVideos() {
            // í˜„ì¬ í˜ì´ì§€ì˜ ëª¨ë“  ë¹„ë””ì˜¤ URL ìˆ˜ì§‘
            const checkboxes = document.querySelectorAll('input[type="checkbox"][id^="video"]');
            checkboxes.forEach(checkbox => {
                if (checkbox.value) {
                    selectedVideos.add(checkbox.value);
                    checkbox.checked = true;
                }
            });
            updateSelectionStatus();
            showAlert(`${checkboxes.length}ê°œ ë¹„ë””ì˜¤ê°€ ì„ íƒë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
        }

        function deselectAllVideos() {
            // ëª¨ë“  ì„ íƒ í•´ì œ
            selectedVideos.clear();
            const checkboxes = document.querySelectorAll('input[type="checkbox"][id^="video"]');
            checkboxes.forEach(checkbox => {
                checkbox.checked = false;
            });
            updateSelectionStatus();
            showAlert('ëª¨ë“  ì„ íƒì´ í•´ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
        }

        function updateSelectionStatus() {
            const selectedCount = selectedVideos.size;
            const totalCount = document.querySelectorAll('input[type="checkbox"][id^="video"]').length;
            
            // ì„ íƒëœ ë¹„ë””ì˜¤ ìˆ˜ í‘œì‹œ ì—…ë°ì´íŠ¸
            const resultCount = document.getElementById('resultCount');
            if (selectedCount > 0) {
                resultCount.textContent = `${selectedCount}/${totalCount}`;
                resultCount.className = 'badge bg-success ms-2';
            } else {
                resultCount.textContent = totalCount;
                resultCount.className = 'badge bg-primary ms-2';
            }
        }

        function downloadSelected() {
            if (selectedVideos.size === 0) {
                showAlert('ë‹¤ìš´ë¡œë“œí•  ë¹„ë””ì˜¤ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.', 'warning');
                return;
            }

            const urls = Array.from(selectedVideos);
            downloadVideos(urls);
        }

        function downloadSingle(url) {
            downloadVideos([url]);
        }

        function downloadVideos(urls) {
            const downloadFolder = getSelectedDownloadFolder();
            showAlert(`${urls.length}ê°œ ë¹„ë””ì˜¤ ë‹¤ìš´ë¡œë“œë¥¼ ì‹œì‘í•©ë‹ˆë‹¤...`, 'info');
            
            fetch('/download', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ 
                    urls: urls,
                    download_folder: downloadFolder
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    showAlert(data.error, 'danger');
                } else {
                    // ìƒì„¸í•œ ê²°ê³¼ í‘œì‹œ
                    let alertType = 'info';
                    if (data.success_count > 0 && data.failed_count === 0) {
                        alertType = 'success';
                    } else if (data.failed_count > 0) {
                        alertType = 'warning';
                    }
                    
                    showAlert(data.message, alertType);
                    
                    // ìŠ¤í‚µëœ íŒŒì¼ì´ ìˆìœ¼ë©´ ìƒì„¸ ì •ë³´ í‘œì‹œ
                    if (data.skipped_count > 0) {
                        let skippedDetails = 'ìŠ¤í‚µëœ íŒŒì¼:\n';
                        data.skipped_files.forEach(file => {
                            skippedDetails += `â€¢ ${file.filename}\n`;
                        });
                        showAlert(skippedDetails, 'info');
                    }
                    
                    // ì‹¤íŒ¨í•œ íŒŒì¼ì´ ìˆìœ¼ë©´ ìƒì„¸ ì •ë³´ í‘œì‹œ
                    if (data.failed_count > 0) {
                        let failedDetails = 'ì‹¤íŒ¨í•œ íŒŒì¼:\n';
                        data.failed_urls.forEach(file => {
                            failedDetails += `â€¢ ${file.url}: ${file.error}\n`;
                        });
                        showAlert(failedDetails, 'danger');
                    }
                    
                    // ë‹¤ìš´ë¡œë“œ ì™„ë£Œ í›„ ì„ íƒ í•´ì œ
                    selectedVideos.clear();
                    // ì²´í¬ë°•ìŠ¤ ëª¨ë‘ í•´ì œ
                    document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
                    updateSelectionStatus();
                }
            })
            .catch(error => {
                showAlert('ë‹¤ìš´ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message, 'danger');
            });
        }

        function getSelectedDownloadFolder() {
            const folderInput = document.getElementById('downloadFolderInput');
            return folderInput.value.trim();
        }

        function loadDownloadFolders() {
            // ì°¸ê³ ìš©ìœ¼ë¡œ í´ë” ëª©ë¡ì„ ë¡œë“œí•˜ì§€ë§Œ UIì—ì„œëŠ” ì‚¬ìš©í•˜ì§€ ì•ŠìŒ
            fetch('/download_folders')
                .then(response => response.json())
                .then(data => {
                    downloadFolders = data.folders;
                })
                .catch(error => {
                    console.error('ë‹¤ìš´ë¡œë“œ í´ë” ëª©ë¡ì„ ê°€ì ¸ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤:', error);
                });
        }


        function showFolderSuggestions() {
            // ëª¨ë‹¬ í‘œì‹œ
            const modal = new bootstrap.Modal(document.getElementById('folderSuggestionsModal'));
            modal.show();
            
            // í´ë” ëª©ë¡ ë¡œë“œ ë° í‘œì‹œ
            loadAndDisplayFolders();
        }

        function loadAndDisplayFolders() {
            fetch('/download_folders')
                .then(response => response.json())
                .then(data => {
                    displaySystemFolders(data.folders);
                    displayProjectFolders(data.folders);
                })
                .catch(error => {
                    console.error('í´ë” ëª©ë¡ì„ ê°€ì ¸ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤:', error);
                    showAlert('í´ë” ëª©ë¡ì„ ê°€ì ¸ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'warning');
                });
        }

        function displaySystemFolders(folders) {
            const systemFoldersDiv = document.getElementById('systemFolders');
            systemFoldersDiv.innerHTML = '';
            
            const systemFolders = folders.filter(folder => folder.type === 'system');
            
            systemFolders.forEach(folder => {
                const folderItem = document.createElement('div');
                folderItem.className = 'list-group-item list-group-item-action d-flex justify-content-between align-items-center';
                folderItem.innerHTML = `
                    <div>
                        <i class="fas fa-folder me-2"></i>
                        <strong>${folder.name}</strong>
                        <br>
                        <small class="text-muted">${folder.path}</small>
                    </div>
                    <button class="btn btn-sm btn-outline-primary" onclick="selectFolder('${folder.path}')">
                        <i class="fas fa-check"></i>
                    </button>
                `;
                systemFoldersDiv.appendChild(folderItem);
            });
        }

        function displayProjectFolders(folders) {
            const projectFoldersDiv = document.getElementById('projectFolders');
            projectFoldersDiv.innerHTML = '';
            
            const projectFolders = folders.filter(folder => folder.type === 'project' || folder.type === 'default');
            
            projectFolders.forEach(folder => {
                const folderItem = document.createElement('div');
                folderItem.className = 'list-group-item list-group-item-action d-flex justify-content-between align-items-center';
                folderItem.innerHTML = `
                    <div>
                        <i class="fas fa-folder me-2"></i>
                        <strong>${folder.name}</strong>
                        <br>
                        <small class="text-muted">${folder.path}</small>
                    </div>
                    <button class="btn btn-sm btn-outline-primary" onclick="selectFolder('${folder.path}')">
                        <i class="fas fa-check"></i>
                    </button>
                `;
                projectFoldersDiv.appendChild(folderItem);
            });
        }

        function selectFolder(folderPath) {
            // ë©”ì¸ ì…ë ¥ í•„ë“œì— ì„ íƒëœ í´ë” ê²½ë¡œ ì„¤ì •
            document.getElementById('downloadFolderInput').value = folderPath;
            
            // ëª¨ë‹¬ ë‹«ê¸°
            const modal = bootstrap.Modal.getInstance(document.getElementById('folderSuggestionsModal'));
            modal.hide();
            
            showAlert(`í´ë”ê°€ ì„ íƒë˜ì—ˆìŠµë‹ˆë‹¤: ${folderPath}`, 'success');
        }

        function selectCustomFolder() {
            const customPath = document.getElementById('customFolderPath').value.trim();
            
            if (!customPath) {
                showAlert('í´ë” ê²½ë¡œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'warning');
                return;
            }
            
            selectFolder(customPath);
        }

        function clearChannelFilter() {
            document.getElementById('channelFilter').value = '';
            hideChannelSuggestions();
            showAlert('ì±„ë„ í•„í„°ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
        }

        function updateCreativeCommonsFilter() {
            const creativeCommons = document.getElementById('creativeCommonsFilter').checked;
            if (creativeCommons) {
                showAlert('í¬ë¦¬ì—ì´í‹°ë¸Œ ì»¤ë¨¼ì¦ˆ í•„í„°ê°€ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
            } else {
                showAlert('í¬ë¦¬ì—ì´í‹°ë¸Œ ì»¤ë¨¼ì¦ˆ í•„í„°ê°€ ë¹„í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
            }
        }

        function updateDurationFilter() {
            const durationFilter = document.getElementById('durationFilter').value;
            const durationLabels = {
                '': 'ì „ì²´',
                'short': '4ë¶„ ë¯¸ë§Œ',
                'medium': '4-20ë¶„',
                'long': '20ë¶„ ì´ìƒ'
            };
            showAlert(`ë¹„ë””ì˜¤ ê¸¸ì´ í•„í„°ê°€ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤: ${durationLabels[durationFilter]}`, 'info');
        }

        let channelSearchTimeout;

        function searchChannels(query) {
            // ì´ì „ íƒ€ì´ë¨¸ ì·¨ì†Œ
            clearTimeout(channelSearchTimeout);
            
            if (!query || query.length < 2) {
                hideChannelSuggestions();
                return;
            }
            
            // 300ms í›„ì— ê²€ìƒ‰ ì‹¤í–‰ (íƒ€ì´í•‘ì´ ëë‚œ í›„)
            channelSearchTimeout = setTimeout(() => {
                fetch('/search_channels', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ query: query })
                })
                .then(response => response.json())
                .then(data => {
                    displayChannelSuggestions(data.channels);
                })
                .catch(error => {
                    console.error('ì±„ë„ ê²€ìƒ‰ ì˜¤ë¥˜:', error);
                    hideChannelSuggestions();
                });
            }, 300);
        }

        function displayChannelSuggestions(channels) {
            const suggestionsDiv = document.getElementById('channelSuggestions');
            
            if (!channels || channels.length === 0) {
                hideChannelSuggestions();
                return;
            }
            
            let html = '';
            channels.forEach(channel => {
                const exactMatchClass = channel.exact_match ? 'exact-match' : '';
                const exactMatchIcon = channel.exact_match ? '<i class="fas fa-check-circle text-success me-1"></i>' : '';
                
                html += `
                    <div class="channel-suggestion-item ${exactMatchClass}" onclick="selectChannel('${channel.channel_title}')">
                        <img src="${channel.thumbnail}" alt="ì±„ë„ ì¸ë„¤ì¼" class="channel-thumbnail">
                        <div class="channel-info">
                            <div class="channel-title">
                                ${exactMatchIcon}${channel.channel_title}
                            </div>
                            <div class="channel-description">${channel.description}</div>
                        </div>
                    </div>
                `;
            });
            
            suggestionsDiv.innerHTML = html;
            suggestionsDiv.style.display = 'block';
        }

        function selectChannel(channelTitle) {
            document.getElementById('channelFilter').value = channelTitle;
            hideChannelSuggestions();
            showAlert(`ì±„ë„ì´ ì„ íƒë˜ì—ˆìŠµë‹ˆë‹¤: ${channelTitle}`, 'success');
        }

        function hideChannelSuggestions() {
            document.getElementById('channelSuggestions').style.display = 'none';
        }

        // ì±„ë„ ì…ë ¥ í•„ë“œ ì™¸ë¶€ í´ë¦­ ì‹œ ì œì•ˆ ìˆ¨ê¸°ê¸°
        document.addEventListener('click', function(e) {
            const channelFilter = document.getElementById('channelFilter');
            const suggestions = document.getElementById('channelSuggestions');
            
            if (!channelFilter.contains(e.target) && !suggestions.contains(e.target)) {
                hideChannelSuggestions();
            }
        });

        function testFolder() {
            const folderPath = getSelectedDownloadFolder();
            
            if (!folderPath) {
                showAlert('í´ë” ê²½ë¡œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'warning');
                return;
            }
            
            // í´ë” í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ API í˜¸ì¶œ
            fetch('/test_folder', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ folder_path: folderPath })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showAlert(`í´ë”ê°€ ìœ íš¨í•©ë‹ˆë‹¤: ${folderPath}`, 'success');
                } else {
                    showAlert(`í´ë” ì˜¤ë¥˜: ${data.error}`, 'danger');
                }
            })
            .catch(error => {
                showAlert('í´ë” í…ŒìŠ¤íŠ¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message, 'danger');
            });
        }

        // Enter í‚¤ë¡œ ê²€ìƒ‰ ì‹¤í–‰
        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchVideos();
            }
        });

        // ===== ì‚¬ìš©ì ê´€ë¦¬ í•¨ìˆ˜ë“¤ =====
        
        function loginUser() {
            const email = document.getElementById('userEmailInput').value.trim();
            
            if (!email) {
                showAlert('ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'warning');
                return;
            }
            
            // ë¡œê·¸ì¸ ì‹œë„
            fetch('/api/user/login', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ email: email })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    currentUser = data.user;
                    updateUserInterface();
                    showAlert(`í™˜ì˜í•©ë‹ˆë‹¤, ${data.user.name}ë‹˜!`, 'success');
                } else {
                    // ì‚¬ìš©ìê°€ ì—†ìœ¼ë©´ ìë™ ë“±ë¡
                    registerUser(email);
                }
            })
            .catch(error => {
                showAlert('ë¡œê·¸ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message, 'danger');
            });
        }
        
        function registerUser(email) {
            fetch('/api/user/register', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ 
                    email: email,
                    name: email.split('@')[0]
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    currentUser = data.user;
                    updateUserInterface();
                    showAlert(`ìƒˆ ê³„ì •ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤, ${data.user.name}ë‹˜!`, 'success');
                } else {
                    showAlert(data.error, 'danger');
                }
            })
            .catch(error => {
                showAlert('íšŒì›ê°€ì… ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message, 'danger');
            });
        }
        
        function logoutUser() {
            currentUser = null;
            userHistory = [];
            userFavorites = [];
            updateUserInterface();
            showAlert('ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
        }
        
        function updateUserInterface() {
            const userInfo = document.getElementById('userInfo');
            const loginForm = document.getElementById('loginForm');
            const userName = document.getElementById('userName');
            const userEmail = document.getElementById('userEmail');
            const historyBtn = document.getElementById('historyBtn');
            const favoritesBtn = document.getElementById('favoritesBtn');
            const logoutBtn = document.getElementById('logoutBtn');
            
            if (currentUser) {
                // ë¡œê·¸ì¸ ìƒíƒœ
                userInfo.style.display = 'block';
                loginForm.style.display = 'none';
                userName.textContent = currentUser.name;
                userEmail.textContent = currentUser.email;
                historyBtn.disabled = false;
                favoritesBtn.disabled = false;
                logoutBtn.style.display = 'inline-block';
            } else {
                // ë¡œê·¸ì•„ì›ƒ ìƒíƒœ
                userInfo.style.display = 'none';
                loginForm.style.display = 'block';
                historyBtn.disabled = true;
                favoritesBtn.disabled = true;
                logoutBtn.style.display = 'none';
            }
        }
        
        function showUserHistory() {
            if (!currentUser) {
                showAlert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.', 'warning');
                return;
            }
            
            const modal = new bootstrap.Modal(document.getElementById('userHistoryModal'));
            modal.show();
            
            // íˆìŠ¤í† ë¦¬ ë¡œë“œ
            fetch(`/api/user/${currentUser.id}/history`)
                .then(response => response.json())
                .then(data => {
                    displayUserHistory(data.history);
                })
                .catch(error => {
                    document.getElementById('historyContent').innerHTML = 
                        '<div class="alert alert-danger">íˆìŠ¤í† ë¦¬ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message + '</div>';
                });
        }
        
        function displayUserHistory(history) {
            const content = document.getElementById('historyContent');
            
            if (!history || history.length === 0) {
                content.innerHTML = '<div class="text-center text-muted">ë‹¤ìš´ë¡œë“œ íˆìŠ¤í† ë¦¬ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }
            
            let html = '<div class="row">';
            history.forEach(item => {
                const job = item.download_jobs;
                if (job) {
                    html += `
                        <div class="col-md-6 mb-3">
                            <div class="card">
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-3">
                                            <img src="${job.video_thumbnail || 'https://via.placeholder.com/120x90'}" 
                                                 alt="ì¸ë„¤ì¼" class="img-fluid rounded">
                                        </div>
                                        <div class="col-md-9">
                                            <h6 class="card-title">${job.video_title || 'ì œëª© ì—†ìŒ'}</h6>
                                            <p class="card-text">
                                                <small class="text-muted">
                                                    <i class="fas fa-user me-1"></i>${job.channel_name || 'Unknown Channel'}<br>
                                                    <i class="fas fa-clock me-1"></i>${job.video_duration || '00:00'}<br>
                                                    <i class="fas fa-calendar me-1"></i>${new Date(job.created_at).toLocaleDateString()}
                                                </small>
                                            </p>
                                            <div class="d-flex justify-content-between align-items-center">
                                                <span class="badge bg-${job.status === 'completed' ? 'success' : job.status === 'failed' ? 'danger' : 'warning'}">
                                                    ${job.status}
                                                </span>
                                                <a href="${job.video_url}" target="_blank" class="btn btn-sm btn-outline-primary">
                                                    <i class="fas fa-external-link-alt me-1"></i>ë³´ê¸°
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }
            });
            html += '</div>';
            content.innerHTML = html;
        }
        
        function showUserFavorites() {
            if (!currentUser) {
                showAlert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.', 'warning');
                return;
            }
            
            const modal = new bootstrap.Modal(document.getElementById('userFavoritesModal'));
            modal.show();
            
            // ì¦ê²¨ì°¾ê¸° ë¡œë“œ
            fetch(`/api/user/${currentUser.id}/favorites`)
                .then(response => response.json())
                .then(data => {
                    displayUserFavorites(data.favorites);
                })
                .catch(error => {
                    document.getElementById('favoritesContent').innerHTML = 
                        '<div class="alert alert-danger">ì¦ê²¨ì°¾ê¸°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message + '</div>';
                });
        }
        
        function displayUserFavorites(favorites) {
            const content = document.getElementById('favoritesContent');
            
            if (!favorites || favorites.length === 0) {
                content.innerHTML = '<div class="text-center text-muted">ì¦ê²¨ì°¾ê¸°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }
            
            let html = '<div class="row">';
            favorites.forEach(favorite => {
                html += `
                    <div class="col-md-6 mb-3">
                        <div class="card">
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-3">
                                        <img src="${favorite.video_thumbnail || 'https://via.placeholder.com/120x90'}" 
                                             alt="ì¸ë„¤ì¼" class="img-fluid rounded">
                                    </div>
                                    <div class="col-md-9">
                                        <h6 class="card-title">${favorite.video_title || 'ì œëª© ì—†ìŒ'}</h6>
                                        <p class="card-text">
                                            <small class="text-muted">
                                                <i class="fas fa-user me-1"></i>${favorite.channel_name || 'Unknown Channel'}<br>
                                                <i class="fas fa-calendar me-1"></i>${new Date(favorite.created_at).toLocaleDateString()}
                                            </small>
                                        </p>
                                        <div class="d-flex justify-content-between align-items-center">
                                            <a href="${favorite.video_url}" target="_blank" class="btn btn-sm btn-outline-primary">
                                                <i class="fas fa-external-link-alt me-1"></i>ë³´ê¸°
                                            </a>
                                            <button class="btn btn-sm btn-outline-danger" onclick="removeFromFavorites('${favorite.video_url}')">
                                                <i class="fas fa-trash me-1"></i>ì œê±°
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
            html += '</div>';
            content.innerHTML = html;
        }
        
        function addToFavorites(videoData) {
            if (!currentUser) {
                showAlert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.', 'warning');
                return;
            }
            
            fetch(`/api/user/${currentUser.id}/favorites`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ video: videoData })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showAlert('ì¦ê²¨ì°¾ê¸°ì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                } else {
                    showAlert(data.error, 'danger');
                }
            })
            .catch(error => {
                showAlert('ì¦ê²¨ì°¾ê¸° ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message, 'danger');
            });
        }
        
        function removeFromFavorites(videoUrl) {
            if (!currentUser) {
                showAlert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.', 'warning');
                return;
            }
            
            fetch(`/api/user/${currentUser.id}/favorites`, {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ video_url: videoUrl })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showAlert('ì¦ê²¨ì°¾ê¸°ì—ì„œ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                    // ì¦ê²¨ì°¾ê¸° ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                    if (document.getElementById('userFavoritesModal').classList.contains('show')) {
                        showUserFavorites();
                    }
                } else {
                    showAlert(data.error, 'danger');
                }
            })
            .catch(error => {
                showAlert('ì¦ê²¨ì°¾ê¸° ì œê±° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message, 'danger');
            });
        }
        
        // ë‹¤ìš´ë¡œë“œ í•¨ìˆ˜ ìˆ˜ì • (ì‚¬ìš©ì ID í¬í•¨)
        function downloadVideos(urls) {
            const downloadFolder = getSelectedDownloadFolder();
            const requestData = {
                urls: urls,
                download_folder: downloadFolder
            };
            
            // ë¡œê·¸ì¸ëœ ì‚¬ìš©ìê°€ ìˆìœ¼ë©´ ì‚¬ìš©ì ID í¬í•¨
            if (currentUser) {
                requestData.user_id = currentUser.id;
            }
            
            showAlert(`${urls.length}ê°œ ë¹„ë””ì˜¤ ë‹¤ìš´ë¡œë“œë¥¼ ì‹œì‘í•©ë‹ˆë‹¤...`, 'info');
            
            fetch('/download', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(requestData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    showAlert(data.error, 'danger');
                } else {
                    // ìƒì„¸í•œ ê²°ê³¼ í‘œì‹œ
                    let alertType = 'info';
                    if (data.success_count > 0 && data.failed_count === 0) {
                        alertType = 'success';
                    } else if (data.failed_count > 0) {
                        alertType = 'warning';
                    }
                    
                    showAlert(data.message, alertType);
                    
                    // ìŠ¤í‚µëœ íŒŒì¼ì´ ìˆìœ¼ë©´ ìƒì„¸ ì •ë³´ í‘œì‹œ
                    if (data.skipped_count > 0) {
                        let skippedDetails = 'ìŠ¤í‚µëœ íŒŒì¼:\n';
                        data.skipped_files.forEach(file => {
                            skippedDetails += `â€¢ ${file.filename}\n`;
                        });
                        showAlert(skippedDetails, 'info');
                    }
                    
                    // ì‹¤íŒ¨í•œ íŒŒì¼ì´ ìˆìœ¼ë©´ ìƒì„¸ ì •ë³´ í‘œì‹œ
                    if (data.failed_count > 0) {
                        let failedDetails = 'ì‹¤íŒ¨í•œ íŒŒì¼:\n';
                        data.failed_urls.forEach(file => {
                            failedDetails += `â€¢ ${file.url}: ${file.error}\n`;
                        });
                        showAlert(failedDetails, 'danger');
                    }
                    
                    // ë‹¤ìš´ë¡œë“œ ì™„ë£Œ í›„ ì„ íƒ í•´ì œ
                    selectedVideos.clear();
                    // ì²´í¬ë°•ìŠ¤ ëª¨ë‘ í•´ì œ
                    document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
                    updateSelectionStatus();
                }
            })
            .catch(error => {
                showAlert('ë‹¤ìš´ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message, 'danger');
            });
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ê¸°ë³¸ í´ë” ì„¤ì •
        document.addEventListener('DOMContentLoaded', function() {
            // ê¸°ë³¸ í´ë” ì„¤ì •
            const folderInput = document.getElementById('downloadFolderInput');
            folderInput.value = 'C:\\Faceon\\video\\down';
            
            // í´ë” ëª©ë¡ ë¡œë“œ (ì°¸ê³ ìš©)
            loadDownloadFolders();
            
            // ì‚¬ìš©ì ì¸í„°í˜ì´ìŠ¤ ì´ˆê¸°í™”
            updateUserInterface();
        });
    </script>
</body>
</html>
